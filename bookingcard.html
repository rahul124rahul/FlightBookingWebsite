<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flight Booking Confirmation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
    }
    .ticket-card {
      max-width: 700px;
      margin: 3rem auto;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      background-color: white;
    }
    .ticket-header {
      background-color: #004085;
      color: white;
      padding: 1.5rem;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      text-align: center;
    }
    .ticket-body {
      padding: 2rem;
    }
    .ticket-section {
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px dashed #ccc;
    }
    .ticket-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.8rem;
    }
    .ticket-label {
      font-weight: bold;
      color: #333;
    }
    .status-badge {
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.9rem;
    }
    .status-confirmed {
      background-color: #d4edda;
      color: #155724;
    }
    .ticket-footer {
      background-color: #004085;
      color: white;
      text-align: center;
      font-size: 0.9rem;
      padding: 1rem;
      border-bottom-left-radius: 10px;
      border-bottom-right-radius: 10px;
    }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #004085;">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Flight Booking System</a>
    </div>
  </nav>

  <!-- Main Booking Card -->
  <div class="ticket-card">
    <div class="ticket-header">
      <h3>Flight Booking Confirmation</h3>
      <p>Booking ID: <span id="bookingId">BOOKING_ID</span></p>
    </div>

    <div class="ticket-body">
      <div class="ticket-section">
        <div class="ticket-row">
          <div class="ticket-label">Passenger Name:</div>
          <div id="name">PASSENGER_NAME</div>
        </div>
        <div class="ticket-row">
          <div class="ticket-label">Passport Number:</div>
          <div id="passport">PASSPORT_NUMBER</div>
        </div>
      </div>

      <div class="ticket-section">
        <div class="ticket-row">
          <div class="ticket-label">Flight Number:</div>
          <div id="flightNo">FLIGHT_NUMBER</div>
        </div>
        <div class="ticket-row">
          <div class="ticket-label">Aircraft Model:</div>
          <div id="aircraft">AIRCRAFT_MODEL</div>
        </div>
      </div>

      <div class="ticket-section">
        <div class="ticket-row">
          <div class="ticket-label">Departure:</div>
          <div id="departure">DEPARTURE_INFO</div>
        </div>
        <div class="ticket-row">
          <div class="ticket-label">Arrival:</div>
          <div id="arrival">ARRIVAL_INFO</div>
        </div>
      </div>

      <div class="ticket-section">
        <div class="ticket-row">
          <div class="ticket-label">Booking Date:</div>
          <div id="bookingTime">BOOKING_DATE</div>
        </div>
        <div class="ticket-row">
          <div class="ticket-label">Seat Number:</div>
          <div id="seat">SEAT_NUMBER</div>
        </div>
        <div class="ticket-row">
          <div class="ticket-label">Class:</div>
          <div id="class">CLASS_TYPE</div>
        </div>
        <div class="ticket-row">
          <div class="ticket-label">Status:</div>
          <div><span class="status-badge status-confirmed" id="status">CONFIRMED</span></div>
        </div>
        <div class="ticket-row">
          <div class="ticket-label">Amount Paid:</div>
          <div id="amount">AMOUNT</div>
        </div>
      </div>
    </div>

    <div class="ticket-footer">
      Thank you for choosing our airline. Have a pleasant journey!
    </div>
  </div>

  <!-- Footer -->
  <footer class="text-white text-center py-3 mt-auto" style="background-color: #004085;">
    &copy; 2025 Flight Booking System
  </footer>

  <!-- JS to fetch booking -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const baseUrl = 'http://localhost:8080';
      const urlParams = new URLSearchParams(window.location.search);
      const bookingId = "1" //urlParams.get('id') || 1; // fallback to 1 if no ID in URL

      fetch(`${baseUrl}/bookings/view/${bookingId}`)
        .then(res => {
          if (!res.ok) throw new Error("Booking not found");
          return res.json();
        })
        .then(data => {
          console.log('Received data:', data);
          
          if (!data) {
            throw new Error("No data received");
          }

          // Format date/time functions
          const formatDateTime = (dateTimeString) => {
            if (!dateTimeString) return 'N/A';
            const date = new Date(dateTimeString);
            return date.toLocaleString();
          };

          // Update the DOM with the fetched data
          document.getElementById("bookingId").textContent = data.bookingId || 'N/A';
          document.getElementById("name").textContent = data.passengerName || 'N/A';
          document.getElementById("passport").textContent = data.passportNumber || 'N/A';
          document.getElementById("flightNo").textContent = data.flightNumber || 'N/A';
          document.getElementById("aircraft").textContent = data.aircraftModel || 'N/A';
          document.getElementById("departure").textContent = 
            data.departureTime ? `At ${formatDateTime(data.departureTime)}` : 'N/A';
          document.getElementById("arrival").textContent = 
            data.arrivalTime ? `At ${formatDateTime(data.arrivalTime)}` : 'N/A';
          document.getElementById("bookingTime").textContent = formatDateTime(data.bookingTime);
          document.getElementById("seat").textContent = data.seatNumber || 'N/A';
          document.getElementById("class").textContent = data.seatClass || 'N/A';
          document.getElementById("status").textContent = data.status || 'N/A';
          document.getElementById("amount").textContent = data.amount ? `â‚¹${data.amount.toFixed(2)}` : 'N/A';
        })
        .catch(err => {
          console.error('Error:', err);
          alert("Failed to load booking data: " + err.message);
          // Optionally redirect to an error page
          // window.location.href = '/error.html';
        });
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>